- id: '1759672008856'
  alias: Starlink Down Notification
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.starlink_connectivity
    to: 'off'
    for:
      hours: 0
      minutes: 1
      seconds: 0
  conditions: []
  actions:
  - action: notify.mobile_app_blue17
    data:
      title: Starlink down
      message: Starlink down for over a minute
  mode: single
- id: '1765422712040'
  alias: cube on when driveway motion
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - light.driveway_light_2
    from: 'off'
    to: 'on'
  conditions:
  - condition: sun
    before: sunrise
    after: sunset
    enabled: true
  actions:
  - type: turn_on
    device_id: 79b4998523fb7f0aaec751079f380f31
    entity_id: 20eaf35d7fc098e488f75e1e7cfdbe22
    domain: switch
  - delay:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - type: turn_off
    device_id: 79b4998523fb7f0aaec751079f380f31
    entity_id: 20eaf35d7fc098e488f75e1e7cfdbe22
    domain: switch
  mode: single
- id: '1767147416914'
  alias: Yard & Porche lights on at sunset
  description: Lights on at dusk
  triggers:
  - trigger: sun
    event: sunset
    offset: 0
  conditions: []
  actions:
  - action: switch.turn_on
    target:
      entity_id:
      - switch.yard_lights
      - light.porche_light_1
  mode: single
- id: '1767148299637'
  alias: Yard lights off at 11pm
  description: ''
  triggers:
  - trigger: time
    at: '23:00:00'
  conditions: []
  actions:
  - action: switch.turn_off
    target:
      entity_id: switch.yard_lights
  mode: single
- id: '1767711547026'
  alias: Freezer Room Light – Door
  description: 'Turn on the freezer room light when the door opens. Announce when
    door opens. After the door closes, wait 10 minutes before turning the light off.

    '
  triggers:
  - entity_id: binary_sensor.freezer_door
    to: 'on'
    trigger: state
  - entity_id: binary_sensor.freezer_door
    to: 'off'
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.freezer_door
        state: 'on'
      sequence:
      - target:
          entity_id: switch.freezer_room_light
        action: switch.turn_on
      - action: media_player.turn_on
        target:
          entity_id: media_player.garage_speaker
      - delay:
          seconds: 1
      - action: media_player.volume_set
        target:
          entity_id: media_player.garage_speaker
        data:
          volume_level: 0.3
      - action: tts.speak
        target:
          entity_id: tts.google_en_com
        data:
          media_player_entity_id: media_player.garage_speaker
          message: '{{ trigger.to_state.attributes.friendly_name }} is open'
      - delay:
          seconds: 3
      - action: media_player.volume_set
        target:
          entity_id: media_player.garage_speaker
        data:
          volume_level: 0.2
    default:
    - delay: 00:10:00
    - target:
        entity_id: switch.freezer_room_light
      action: switch.turn_off
  mode: restart
- id: '1768001234567'
  alias: Costco Door Light
  description: Turn on the Costco light when the door opens. Announce when door opens.
    After the door closes, wait 10 minutes before turning the light off.
  triggers:
  - trigger: state
    entity_id: binary_sensor.costco_door
    to: 'on'
  - trigger: state
    entity_id: binary_sensor.costco_door
    to: 'off'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.costco_door
        state: 'on'
      sequence:
      - action: light.turn_on
        target:
          entity_id: light.costco_light_1
      - action: media_player.turn_on
        target:
          entity_id: media_player.garage_speaker
      - delay:
          seconds: 1
      - action: media_player.volume_set
        target:
          entity_id: media_player.garage_speaker
        data:
          volume_level: 0.3
      - action: tts.speak
        target:
          entity_id: tts.google_en_com
        data:
          media_player_entity_id: media_player.garage_speaker
          message: '{{ trigger.to_state.attributes.friendly_name }} is open'
      - delay:
          seconds: 3
      - action: media_player.volume_set
        target:
          entity_id: media_player.garage_speaker
        data:
          volume_level: 0.2
    default:
    - delay: 00:10:00
    - action: light.turn_off
      target:
        entity_id: light.costco_light_1
  mode: restart
- id: '1768001234568'
  alias: Tesla Room Light – Door
  description: Turn on the Tesla room light when the door opens. Announce when door opens.
    After the door closes, wait 5 minutes before turning the light off.
  triggers:
  - trigger: state
    entity_id: binary_sensor.tesla_door
    to: 'on'
  - trigger: state
    entity_id: binary_sensor.tesla_door
    to: 'off'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.tesla_door
        state: 'on'
      sequence:
      - action: light.turn_on
        target:
          entity_id: light.light_2
      - action: media_player.turn_on
        target:
          entity_id: media_player.garage_speaker
      - delay:
          seconds: 1
      - action: media_player.volume_set
        target:
          entity_id: media_player.garage_speaker
        data:
          volume_level: 0.3
      - action: tts.speak
        target:
          entity_id: tts.google_en_com
        data:
          media_player_entity_id: media_player.garage_speaker
          message: '{{ trigger.to_state.attributes.friendly_name }} is open'
      - delay:
          seconds: 3
      - action: media_player.volume_set
        target:
          entity_id: media_player.garage_speaker
        data:
          volume_level: 0.2
    default:
    - delay: 00:05:00
    - action: light.turn_off
      target:
        entity_id: light.light_2
  mode: restart
- id: '1767735071677'
  alias: 'Cube On '
  description: Turn on stairs and driveway when cube is turned on
  triggers:
  - type: turned_on
    device_id: cac2a6a1c75902c5c2097a3b17315b8c
    entity_id: 2869ad9a5c65b4e6e2b17c9255d233b4
    domain: switch
    trigger: device
  conditions: []
  actions:
  - type: turn_on
    device_id: 2ecb4ff5960709c8f2cdfc8b103c1cd9
    entity_id: d0e1901526d2ea9d56e87247970296a9
    domain: light
  - type: turn_on
    device_id: 96720349fc8644fab65970f726e96047
    entity_id: 472222c70cae9813082dbb8fbabaea8b
    domain: light
  mode: single
- id: '1767735161605'
  alias: Cube Off
  description: Turn off stairs and driveway when cube off
  triggers:
  - type: turned_off
    device_id: cac2a6a1c75902c5c2097a3b17315b8c
    entity_id: 2869ad9a5c65b4e6e2b17c9255d233b4
    domain: switch
    trigger: device
  conditions: []
  actions:
  - type: turn_off
    device_id: 2ecb4ff5960709c8f2cdfc8b103c1cd9
    entity_id: d0e1901526d2ea9d56e87247970296a9
    domain: light
  - type: turn_off
    device_id: 96720349fc8644fab65970f726e96047
    entity_id: 472222c70cae9813082dbb8fbabaea8b
    domain: light
  mode: single
- id: button1_toggle_bedroom
  alias: Bedside Button1 → Toggle Master Bedroom Light
  trigger:
  - platform: state
    entity_id: event.button1
  condition:
  - condition: template
    value_template: "{{ trigger.to_state is not none\n   and trigger.to_state.attributes.event_type
      == 'multi_press_1' }}\n"
  action:
  - service: light.toggle
    target:
      entity_id: light.master_bedroom
  mode: single
- id: button2_toggle_gym
  alias: Bedside Button2 → Toggle Gym Light
  trigger:
  - platform: state
    entity_id: event.button2
  condition:
  - condition: template
    value_template: "{{ trigger.to_state is not none\n   and trigger.to_state.attributes.event_type
      == 'multi_press_1' }}\n"
  action:
  - service: light.toggle
    target:
      entity_id: light.gym_light
  mode: single
- id: '1767927944559'
  alias: Auto turn off laundry light after 10 minutes
  description: ''
  use_blueprint:
    path: homeassistant/auto_light_off.yaml
    input:
      target_light: light.laundry_light
- id: '1767935589924'
  alias: Announce Storage Doors
  description: Announce when any storage door opens
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.gas_door
    - binary_sensor.tesla_door
    - binary_sensor.costco_door
    - binary_sensor.bano_abajo_door
    - binary_sensor.casita_door
    to: 'on'
  - trigger: state
    entity_id: cover.remootio_gate
    to:
    - opening
  actions:
  - action: media_player.turn_on
    target:
      entity_id: media_player.garage_speaker
  - delay:
      seconds: 1
  - variables:
      garage_volume: '{{ state_attr(''media_player.garage_speaker'', ''volume_level'')
        }}'
      living_volume: '{{ state_attr(''media_player.living_room'', ''volume_level'')
        }}'
  - action: media_player.volume_set
    target:
      entity_id:
      - media_player.garage_speaker
      - media_player.living_room
    data:
      volume_level: 0.3
  - action: tts.speak
    target:
      entity_id: tts.google_en_com
    data:
      media_player_entity_id:
      - media_player.garage_speaker
      - media_player.living_room
      message: '{{ trigger.to_state.attributes.friendly_name }} is open'
  - delay:
      seconds: 3
  - action: media_player.volume_set
    target:
      entity_id: media_player.garage_speaker
    data:
      volume_level: '{{ garage_volume }}'
  - action: media_player.volume_set
    target:
      entity_id: media_player.living_room
    data:
      volume_level: '{{ living_volume }}'
  - action: notify.mobile_app_blue17
    data:
      title: Door Open Alert
      message: '{{ trigger.to_state.attributes.friendly_name }} is open'
- id: '1768176372508'
  alias: Announce Storage Doors Open 15 Minutes
  description: Announce when any storage door has been open for 15 minutes, repeating
    every 15 minutes
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.gas_door
    - binary_sensor.tesla_door
    - binary_sensor.costco_door
    - binary_sensor.bano_abajo_door
    - binary_sensor.casita_door
    to: 'on'
    for:
      minutes: 15
  - trigger: state
    entity_id: cover.remootio_gate_none
    to: open
    for:
      minutes: 15
  actions:
  - repeat:
      while:
      - condition: template
        value_template: '{{ is_state(trigger.entity_id, ''on'') or is_state(trigger.entity_id,
          ''open'') }}'
      - condition: template
        value_template: '{{ not is_state(trigger.entity_id, ''unavailable'') }}'
      sequence:
      - action: media_player.turn_on
        target:
          entity_id: media_player.garage_speaker
      - delay:
          seconds: 1
      - variables:
          garage_volume: '{{ state_attr(''media_player.garage_speaker'', ''volume_level'')
            }}'
          living_volume: '{{ state_attr(''media_player.living_room'', ''volume_level'')
            }}'
      - action: media_player.volume_set
        target:
          entity_id:
          - media_player.garage_speaker
          - media_player.living_room
        data:
          volume_level: 0.3
      - action: tts.speak
        target:
          entity_id: tts.google_en_com
        data:
          media_player_entity_id:
          - media_player.living_room
          - media_player.garage_speaker
          message: '{% set duration = now() - trigger.to_state.last_changed %} {%
            set minutes = duration.total_seconds() // 60 %} {{ trigger.to_state.attributes.friendly_name
            }} has been open for {{ minutes | int }} minutes'
      - delay:
          seconds: 3
      - action: media_player.volume_set
        target:
          entity_id: media_player.garage_speaker
        data:
          volume_level: '{{ garage_volume }}'
      - action: media_player.volume_set
        target:
          entity_id: media_player.living_room
        data:
          volume_level: '{{ living_volume }}'
      - action: notify.mobile_app_blue17
        data:
          title: Door Still Open Alert
          message: '{% set duration = now() - trigger.to_state.last_changed %} {%
            set minutes = duration.total_seconds() // 60 %} {{ trigger.to_state.attributes.friendly_name
            }} has been open for {{ minutes | int }} minutes'
      - delay:
          minutes: 15
  mode: restart
- id: '1768219002142'
  description: Lights off at sunrise
  triggers:
  - trigger: sun
    event: sunrise
    offset: 0
  conditions: []
  actions:
  - action: homeassistant.turn_off
    target:
      entity_id:
      - switch.yard_lights
      - light.porche_light_1
      - light.balcony_light_1
      - switch.cube
  mode: single
- id: '1768220426361'
  alias: Guest off after 1 hour
  description: ''
  use_blueprint:
    path: homeassistant/auto_device_off.yaml
    input:
      target_device: switch.guest_bath
      minutes_on: 60
- id: '1768220617626'
  alias: 'Toilet off in10 '
  description: ''
  use_blueprint:
    path: homeassistant/auto_device_off.yaml
    input:
      target_device: switch.master_toilet
- id: '1768220723925'
  alias: Kids' Bath auto off
  description: ''
  use_blueprint:
    path: homeassistant/auto_device_off.yaml
    input:
      target_device: switch.kids_bath
      minutes_on: 90
- id: '1768251628941'
  alias: Storage Door Sensors - Availability Notifications
  description: Alert when any storage door sensor goes unavailable or comes back online
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.gas_door
    - binary_sensor.tesla_door
    - binary_sensor.costco_door
    - binary_sensor.front_door
    - binary_sensor.bano_abajo_door
    - binary_sensor.casita_door
    to: unavailable
    id: went_unavailable
  - trigger: state
    entity_id:
    - binary_sensor.gas_door
    - binary_sensor.tesla_door
    - binary_sensor.costco_door
    - binary_sensor.front_door
    - binary_sensor.bano_abajo_door
    - binary_sensor.casita_door
    from: unavailable
    id: came_back
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: went_unavailable
      sequence:
      - action: notify.mobile_app_blue17
        data:
          title: ⚠️ Sensor Offline
          message: '{{ trigger.to_state.attributes.friendly_name }} is unavailable'
    - conditions:
      - condition: trigger
        id: came_back
      sequence:
      - action: notify.mobile_app_blue17
        data:
          title: ✅ Sensor Back Online
          message: '{{ trigger.to_state.attributes.friendly_name }} is back online'
  mode: queued
  max: 10
- id: '1769300000001'
  alias: WAN Starlink Offline Notification
  description: Notify when Starlink (wan1) goes offline or unknown for more than 1 minute
  triggers:
  - trigger: state
    entity_id:
    - sensor.mesh_node_gw_office_wan1_status
    to:
    - 'offline'
    - 'unknown'
    for:
      minutes: 1
  conditions: []
  actions:
  - action: notify.mobile_app_blue17
    data:
      title: Starlink Offline
      message: "Starlink (eth1) is {{ states('sensor.mesh_node_gw_office_wan1_status') }} for over 1 minute"
  mode: single
- id: '1769300000002'
  alias: WAN T-Mobile Offline Notification
  description: Notify when T-Mobile (wan2) goes offline or unknown for more than 1 minute
  triggers:
  - trigger: state
    entity_id:
    - sensor.mesh_node_gw_office_wan2_status
    to:
    - 'offline'
    - 'unknown'
    for:
      minutes: 1
  conditions: []
  actions:
  - action: notify.mobile_app_blue17
    data:
      title: T-Mobile Offline
      message: "T-Mobile (eth2) is {{ states('sensor.mesh_node_gw_office_wan2_status') }} for over 1 minute"
  mode: single
- id: '1769300000003'
  alias: WAN Back Online Notification
  description: Notify when either WAN comes back online
  triggers:
  - trigger: state
    entity_id:
    - sensor.mesh_node_gw_office_wan1_status
    to: 'online'
    id: starlink
  - trigger: state
    entity_id:
    - sensor.mesh_node_gw_office_wan2_status
    to: 'online'
    id: tmobile
  conditions: []
  actions:
  - action: notify.mobile_app_blue17
    data:
      title: WAN Back Online
      message: >-
        {% if trigger.id == 'starlink' %}Starlink (eth1){% else %}T-Mobile (eth2){% endif %} is back online
  mode: queued
  max: 5
